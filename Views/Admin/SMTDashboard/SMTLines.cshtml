@* @using MESWebDev.Models.UVASSY
@using MESWebDev.Models.VM
@model List<UVAssyAllOutputResult> *@
@model DashboardViewModel;
@using System.Text.Json;
@using System.Data;
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
@section ContentHeader {
<div class="app-content-header">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <ol class="breadcrumb float-sm-end d-flex justify-content-center align-content-center" style="margin-bottom:0px !important">
                    <li class="breadcrumb-item text-black fw-bold">HOME</li>
                    <li class="breadcrumb-item active fw-bold" aria-current="page">SMT DASHBOARD</li>
                </ol>
            </div>
        </div>
    </div>
</div>
}
<div class="app-content">
    <div class="container-fluid p-0 px-5">
        <!-- HEADER -->
        <div class="row text-center">
            <div class="col-md-3 d-flex align-items-center justify-content-center">
                <!-- <h4>Info</h4> -->
            </div>
            <div class="col-md-6">
                <div class="iqc-shape">SMT RUNNING LINES</div>
            </div>
            <div class="col-md-3 d-flex align-items-center justify-content-center">
                <h4 id="clock"></h4>
            </div>
        </div>

        <!-- SMT RUNNING LINE -->
   
       @*  <div class="row row-cols-6  mt-2 g-2">
            @if (Model.detail_data != null && Model.detail_data.Rows.Count > 0)
            {
                foreach (DataRow item in Model.detail_data.Rows)
                {
                    <div class="divLine">
                        <div class="col-12 detail py-3 border border-2 border-info">
                            <div class="row ">
                                <div class="col-12 d-flex justify-content-center align-items-center">
                                    <h2 class="lineValue"> @item[0] </h2>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12 text-center">
                    <p>No Line available</p>
                </div>
            }
        </div> *@
        <style>
            /* Màu cam nhạt tùy chỉnh cho status = 0 */
            .bg-orange-light {
                background-color: #ffcc80 !important; /* Màu cam nhạt pastel */
                border-color: #ffb74d !important; /* Viền cam đậm hơn một chút */
                color: #5d4037 !important; /* Chữ màu nâu đậm cho dễ đọc trên nền cam */
            }

            /* Hiệu ứng hover để người dùng biết là nhấn được */
            .divLine:hover .detail {
                opacity: 0.8;
                transform: scale(1.02);
                transition: all 0.2s ease-in-out;
            }
        </style>
        <div class="row row-cols-6 mt-2 g-2">
            @if (Model.detail_data != null && Model.detail_data.Rows.Count > 0)
            {
                @foreach (DataRow item in Model.detail_data.Rows)
                {
                    var status = item[1]?.ToString();
                    var isRunning = (status == "1");

                    // Nếu chạy (1): Dùng class 'divLine' để click và 'border-info' để hiện màu xanh.
                    // Nếu dừng (0): Dùng class 'line-disabled' để làm chìm và chặn click.
                    var wrapperClass = isRunning ? "divLine" : "line-disabled";
                    var statusStyle = isRunning ? "border-info" : "border-secondary opacity-50 bg-dark";

                    <div class="@wrapperClass">
                        <div class="col-12 detail py-3 border border-2 @statusStyle">
                            <div class="row ">
                                <div class="col-12 d-flex justify-content-center align-items-center">
                                    <h2 class="lineValue @(isRunning ? "" : "text-secondary")"> @item[0] </h2>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12 text-center">
                    <p>No Line available</p>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <link href="~/css/dashboard.css?@DateTime.Now.Ticks" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
        //--------------------->> TABLE <<-------------------------------
          function updateClock() {
            const now = new Date();

            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hour = String(now.getHours()).padStart(2, '0');
            const minute = String(now.getMinutes()).padStart(2, '0');
            const second = String(now.getSeconds()).padStart(2, '0');

            const formatted = `${year}-${month}-${day} ${hour}:${minute}:${second}`;

            document.getElementById('clock').textContent = formatted;
          }

          // Update immediately and every second
          updateClock();
          setInterval(updateClock, 1000);

          $('.divLine').click(function() {
            var lineValue = $(this).find('.lineValue').text().trim();
            if (lineValue) {
                window.location.href = '@Url.Action("SMTProdInfo", "Admin")?line=' + lineValue;
            }
          });


    </script>
}